{% comment %}
  Before & After Section
  Displays before/after image comparisons to showcase product results.
{% endcomment %}

{% style %}
  #before-after-{{ section.id }} {
    padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px;
    background-color: {{ section.settings.background_color }};
  }

  #before-after-{{ section.id }} .before-after__header {
    text-align: {{ section.settings.heading_alignment }};
    margin-bottom: {{ section.settings.heading_spacing }}px;
  }

  #before-after-{{ section.id }} .before-after__heading {
    color: {{ section.settings.heading_color }};
  }

  #before-after-{{ section.id }} .before-after__description {
    color: {{ section.settings.text_color }};
  }
{% endstyle %}

<div id="before-after-{{ section.id }}" class="before-after">
  <div class="before-after__container">
    {% liquid
      assign ba_heading = shop.metafields.custom.before_after_heading | default: section.settings.heading
      assign ba_description = shop.metafields.custom.before_after_description | default: section.settings.description
    %}

    {% if ba_heading != blank or ba_description != blank %}
      <div class="before-after__header">
        {% if ba_heading != blank %}
          <h2 class="before-after__heading">{{ ba_heading }}</h2>
        {% endif %}

        {% if ba_description != blank %}
          <p class="before-after__description">{{ ba_description }}</p>
        {% endif %}
      </div>
    {% endif %}

    {% if section.blocks.size > 0 %}
      <div class="before-after__grid">
        {% for block in section.blocks %}
          <div class="before-after__item" {{ block.shopify_attributes }}>
            <div class="before-after__comparison">
              <div class="before-after__image-wrapper">
                <div class="before-after__before">
                  {% if block.settings.before_image != blank %}
                    {{ block.settings.before_image | image_url: width: 800 | image_tag: loading: 'lazy', alt: 'Before' }}
                  {% else %}
                    <div class="before-after__placeholder">
                      {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
                    </div>
                  {% endif %}
                  <span class="before-after__label before-after__label--before">{{ block.settings.before_label }}</span>
                </div>

                <div class="before-after__after">
                  {% if block.settings.after_image != blank %}
                    {{ block.settings.after_image | image_url: width: 800 | image_tag: loading: 'lazy', alt: 'After' }}
                  {% else %}
                    <div class="before-after__placeholder">
                      {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
                    </div>
                  {% endif %}
                  <span class="before-after__label before-after__label--after">{{ block.settings.after_label }}</span>
                </div>

                <div class="before-after__divider"></div>
              </div>
            </div>

            {% if block.settings.caption != blank %}
              <p class="before-after__caption">{{ block.settings.caption }}</p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="before-after__empty">
        <p>Add before/after comparison blocks to showcase your product results.</p>
      </div>
    {% endif %}
  </div>
</div>

{% stylesheet %}
  .before-after {
    width: 100%;
  }

  .before-after__container {
    max-width: var(--page-width);
    margin: 0 auto;
    padding: 0 var(--page-margin);
  }

  .before-after__header {
    margin-bottom: 3rem;
  }

  .before-after__heading {
    font-size: clamp(2rem, 4vw, 3rem);
    margin-bottom: 1rem;
  }

  .before-after__description {
    font-family: var(--font-body--family);
    font-size: 1.125rem;
    line-height: 1.6;
    opacity: 0.9;
    max-width: 600px;
    margin: 0 auto;
  }

  .before-after__grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 3rem;
  }

  .before-after__item {
    display: flex;
    flex-direction: column;
  }

  .before-after__comparison {
    position: relative;
    overflow: hidden;
    border-radius: 4px;
    margin-bottom: 1rem;
  }

  .before-after__image-wrapper {
    position: relative;
    width: 100%;
    padding-bottom: 100%;
    overflow: hidden;
    background: #F5F1E8;
  }

  .before-after__before,
  .before-after__after {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .before-after__before {
    z-index: 1;
  }

  .before-after__after {
    z-index: 2;
    clip-path: polygon(50% 0, 100% 0, 100% 100%, 50% 100%);
  }

  .before-after__before img,
  .before-after__after img,
  .before-after__placeholder {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .before-after__placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    background: #E8DCC8;
  }

  .before-after__placeholder svg {
    width: 50%;
    height: 50%;
    opacity: 0.3;
  }

  .before-after__divider {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 3px;
    height: 100%;
    background: #fff;
    z-index: 3;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
  }

  .before-after__divider::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    background: #fff;
    border-radius: 50%;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  }

  .before-after__divider::after {
    content: '‚ü∑';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 20px;
    color: #4A3F35;
    z-index: 1;
  }

  .before-after__label {
    position: absolute;
    bottom: 1rem;
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.95);
    color: #4A3F35;
    font-family: var(--font-body--family);
    font-size: 0.875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: 2px;
    z-index: 4;
  }

  .before-after__label--before {
    left: 1rem;
  }

  .before-after__label--after {
    right: 1rem;
  }

  .before-after__caption {
    text-align: center;
    font-family: var(--font-body--family);
    font-size: 0.9375rem;
    line-height: 1.5;
    color: var(--color-foreground);
    opacity: 0.8;
    margin: 0;
  }

  .before-after__empty {
    text-align: center;
    padding: 3rem;
    background: rgba(196, 165, 116, 0.1);
    border-radius: 4px;
    border: 2px dashed rgba(196, 165, 116, 0.3);
  }

  .before-after__empty p {
    font-size: 1rem;
    color: #C4A574;
    font-weight: 500;
    margin: 0;
  }

  /* Mobile adjustments */
  @media (max-width: 768px) {
    .before-after__grid {
      grid-template-columns: 1fr;
      gap: 2rem;
    }

    .before-after__header {
      margin-bottom: 2rem;
    }

    .before-after__heading {
      font-size: 1.75rem;
    }

    .before-after__description {
      font-size: 1rem;
    }

    .before-after__label {
      font-size: 0.75rem;
      padding: 0.375rem 0.75rem;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Before & After",
  "settings": [
    {
      "type": "header",
      "content": "Heading"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Real Results",
      "info": "Can be overridden by shop metafield: custom.before_after_heading"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "See the transformative power of our products through real customer results",
      "info": "Can be overridden by shop metafield: custom.before_after_description"
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "Heading alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "center"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading color",
      "default": "#4A3F35"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Description color",
      "default": "#4A3F35"
    },
    {
      "type": "range",
      "id": "heading_spacing",
      "min": 20,
      "max": 80,
      "step": 4,
      "unit": "px",
      "label": "Spacing below heading",
      "default": 48
    },
    {
      "type": "header",
      "content": "Section styling"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Section spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 80
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 80
    }
  ],
  "blocks": [
    {
      "type": "comparison",
      "name": "Before/After Comparison",
      "settings": [
        {
          "type": "image_picker",
          "id": "before_image",
          "label": "Before image"
        },
        {
          "type": "text",
          "id": "before_label",
          "label": "Before label",
          "default": "Before"
        },
        {
          "type": "image_picker",
          "id": "after_image",
          "label": "After image"
        },
        {
          "type": "text",
          "id": "after_label",
          "label": "After label",
          "default": "After"
        },
        {
          "type": "textarea",
          "id": "caption",
          "label": "Caption",
          "default": "After 4 weeks of daily use"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Before & After",
      "blocks": [
        {
          "type": "comparison",
          "settings": {
            "before_label": "Before",
            "after_label": "After",
            "caption": "After 4 weeks of daily use"
          }
        },
        {
          "type": "comparison",
          "settings": {
            "before_label": "Before",
            "after_label": "After",
            "caption": "After 8 weeks of daily use"
          }
        }
      ]
    }
  ]
}
{% endschema %}
