<div
  id="video-{{ section.id }}"
  class="video-section"
>
  <div class="video-section__container">
    {% if section.settings.heading != blank or section.settings.description != blank %}
      <div class="video-section__header">
        {% if section.settings.heading != blank %}
          <h2 class="video-section__heading">{{ section.settings.heading }}</h2>
        {% endif %}
        {% if section.settings.description != blank %}
          <div class="video-section__description">{{ section.settings.description }}</div>
        {% endif %}
      </div>
    {% endif %}

    <div class="video-section__wrapper">
      {% if section.settings.video_url != blank %}
        {% assign video_id = section.settings.video_url | split: 'v=' | last | split: '&' | first %}
        {% if section.settings.video_url contains 'youtu' %}
          <div class="video-section__embed">
            <iframe
              src="https://www.youtube.com/embed/{{ video_id }}?rel=0&modestbranding=1"
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
              loading="lazy"
            ></iframe>
          </div>
        {% elsif section.settings.video_url contains 'vimeo' %}
          {% assign vimeo_id = section.settings.video_url | split: 'vimeo.com/' | last | split: '/' | first %}
          <div class="video-section__embed">
            <iframe
              src="https://player.vimeo.com/video/{{ vimeo_id }}"
              frameborder="0"
              allow="autoplay; fullscreen; picture-in-picture"
              allowfullscreen
              loading="lazy"
            ></iframe>
          </div>
        {% endif %}
      {% elsif section.settings.video != blank %}
        <div class="video-section__native">
          {{ section.settings.video | video_tag:
             controls: true,
             autoplay: section.settings.autoplay,
             loop: section.settings.loop,
             muted: section.settings.muted
          }}
        </div>
      {% else %}
        <div class="video-section__placeholder">
          <p>Add a video URL or upload a video file</p>
        </div>
      {% endif %}
    </div>
  </div>
</div>

{% style %}
  #video-{{ section.id }} {
    padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px;
    background-color: {{ section.settings.background_color }};
  }
{% endstyle %}

{% stylesheet %}
  .video-section {
    width: 100%;
  }

  .video-section__container {
    max-width: var(--page-width);
    margin: 0 auto;
    padding: 0 var(--page-margin);
  }

  .video-section__header {
    text-align: center;
    margin-bottom: 2rem;
  }

  .video-section__heading {
    font-family: var(--font-heading--family);
    font-size: clamp(2rem, 4vw, 3rem);
    font-weight: 400;
    color: var(--color-foreground);
    margin: 0 0 1rem 0;
  }

  .video-section__description {
    font-family: var(--font-body--family);
    font-size: 1.125rem;
    line-height: 1.6;
    color: var(--color-foreground);
    opacity: 0.9;
    max-width: 600px;
    margin: 0 auto;
  }

  .video-section__wrapper {
    max-width: 1000px;
    margin: 0 auto;
  }

  .video-section__embed {
    position: relative;
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
    height: 0;
    overflow: hidden;
    border-radius: 8px;
    background: #000;
  }

  .video-section__embed iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .video-section__native {
    position: relative;
    border-radius: 8px;
    overflow: hidden;
    background: #000;
  }

  .video-section__native video {
    width: 100%;
    height: auto;
    display: block;
  }

  .video-section__placeholder {
    padding: 4rem 2rem;
    text-align: center;
    background: var(--color-background);
    border: 2px dashed rgba(74, 63, 53, 0.3);
    border-radius: 8px;
  }

  .video-section__placeholder p {
    font-family: var(--font-body--family);
    font-size: 1rem;
    color: var(--color-foreground);
    opacity: 0.6;
    margin: 0;
  }

  @media screen and (max-width: 768px) {
    .video-section__header {
      margin-bottom: 1.5rem;
    }

    .video-section__heading {
      font-size: 1.75rem;
      margin-bottom: 0.75rem;
    }

    .video-section__description {
      font-size: 1rem;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Video",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Watch Our Story"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Discover the science and passion behind our skincare products</p>"
    },
    {
      "type": "header",
      "content": "Video Settings"
    },
    {
      "type": "video_url",
      "id": "video_url",
      "label": "Video URL",
      "accept": ["youtube", "vimeo"],
      "info": "Add a YouTube or Vimeo URL"
    },
    {
      "type": "video",
      "id": "video",
      "label": "Upload Video",
      "info": "Upload a video file (MP4 recommended). This will be used if no URL is provided."
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay",
      "default": false,
      "info": "Only applies to uploaded videos"
    },
    {
      "type": "checkbox",
      "id": "loop",
      "label": "Loop video",
      "default": false,
      "info": "Only applies to uploaded videos"
    },
    {
      "type": "checkbox",
      "id": "muted",
      "label": "Mute video",
      "default": false,
      "info": "Only applies to uploaded videos"
    },
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#F5F1E8"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 60
    }
  ],
  "presets": [
    {
      "name": "Video",
      "category": "Media"
    }
  ]
}
{% endschema %}
